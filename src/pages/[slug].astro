---
import Layout from "../layouts/Layout.astro";

import TagDisplay from "../components/TagDisplay.astro";
import { CollectionEntry, getCollection } from "astro:content";
import { Project, addToIndex } from "../typescript/search";
import { Tags } from "../others/tags";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    
    projects.map(project => {
        const projectObj: Project = {
            title: project.data.title,
            shortDescription: project.data.shortDescription,
            releaseDate: project.data.releaseDate,
            githubLink: project.data.githubLink,
            thumbnailPath: project.data.thumbnailPath,
            tags: project.data.tags.map(tag => tag.toString()),
            ifShow: project.data.ifShow
        }
        addToIndex(projectObj);
    })

    return projects.map(project => ({
        params: {
            slug: project.slug
        },
        props: {
            project
        }
    }));
} 

interface ProjectContentCollections {
    project: CollectionEntry<"projects">,
}

const { project } = Astro.props as ProjectContentCollections;
const { Content, headings } = await project.render();
const data = project.data;
const dateOptions: Intl.DateTimeFormatOptions = { day: "numeric", month: "long", year: "numeric" };
// TODO (LOW): Detect the user's location using window.navigator.language
// But need to use <script></script>
const userLocale="en-UK";
// TODO (LOW): Table of content with headings? 
// console.log(headings);
---

<Layout title={data.title}>
    <article>
        <div class="container">
            <div class="card">
                <h1>{data.title}</h1>
                <img src={data.thumbnailPath} alt={data.title + " image"}>
                <div style="height: 25px;"></div> <!-- Small block to seperate img and tags -->
                <TagDisplay tags={data.tags} project={data.title}/>
                <h4><strong>Release Date: </strong>{new Date(data.releaseDate).toLocaleDateString(userLocale, dateOptions)}</h4>
                <ul class="markdown list-of-links">
                    <li>{data.projectLink != null && <a href={data.projectLink}>Project Link</a>}</li>
                    <li>{data.githubLink != null && <a href={data.githubLink}>GitHub Link</a>}</li>
                </ul>
                <h3>Description</h3>
                <p>{data.shortDescription}</p>
                <hr>
                <div class="markdown">
                    <Content />
                </div>
            </div>
        </div>
    </article>
</Layout>

<style>
    .list-of-links {
        list-style: none;
        padding: 0;
        display: flex;
    }

    .list-of-links li {
        padding-right: 15px;
    }

    img {
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
    }
</style>

<!-- Markdown styling needs to be global: https://github.com/withastro/astro/issues/3045 -->
<style is:global>
    
    .markdown img {
        width: 100%;
        max-width: 500px;
    }

</style>